-- Create a table that doesn't satisfy 4NF
CREATE TABLE Orders (
    OrderID INT,
    CustomerName VARCHAR2(20),
    Product VARCHAR2(20),
    Quantity INT,
    ProductPrice DECIMAL(5,2),
    Supplier VARCHAR2(20)
);
DESC Orders;

-- Insert data that doesn't satisfy 4NF
INSERT INTO Orders VALUES (1, 'Alex', 'Apple', 10, 0.5, 'Supplier1');
INSERT INTO Orders VALUES (2, 'Alex', 'Banana', 15, 0.3, 'Supplier2');
INSERT INTO Orders VALUES (3, 'Allson', 'Orange', 20, 0.7, 'Supplier3');
INSERT INTO Orders VALUES (4, 'Allson', 'Mango', 25, 1.0, 'Supplier4');

-- Transform the table and its data into 4NF
CREATE TABLE Customers AS
SELECT DISTINCT OrderID, CustomerName
FROM Orders;

CREATE TABLE OrderDetails AS
SELECT OrderID, Product, Quantity
FROM Orders;

CREATE TABLE Products AS
SELECT DISTINCT Product, ProductPrice, Supplier
FROM Orders;

-- Add primary keys and foreign keys
ALTER TABLE Customers
ADD CONSTRAINT pk_OrderID PRIMARY KEY (OrderID);

ALTER TABLE OrderDetails
ADD CONSTRAINT fk_OrderID FOREIGN KEY (OrderID)
REFERENCES Customers(OrderID);

ALTER TABLE Products
ADD CONSTRAINT pk_Product PRIMARY KEY (Product);

ALTER TABLE OrderDetails
ADD CONSTRAINT fk_Product FOREIGN KEY (Product)
REFERENCES Products(Product);

DESC Customers;
DESC OrderDetails;
DESC Products;

-- Display the tables (they should be in 4NF now)
SELECT * FROM Customers;
SELECT * FROM OrderDetails;
SELECT * FROM Products;

-- Drop all created tables
DROP TABLE Orders;
DROP TABLE OrderDetails;
DROP TABLE Customers;
DROP TABLE Products;
